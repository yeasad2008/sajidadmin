<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ভাইরাল ভিডিও সার্ভার</title>
  <style>
    /* আপনার আগের সকল CSS কোড এখানে অপরিবর্তিত আছে */
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Arial',sans-serif;background:#EAECEF;color:#333}
    header{background:#1a1a2e; color:#fff; display: flex; align-items: center; justify-content: space-between; gap: 15px; padding:10px 14px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);}
    .global-menu-btn{position:static; transform:none; font-size:26px;}
    #searchInput { flex-grow: 1; padding: 10px 15px; border: 1px solid #4a4a5e; background-color: #2a2a3e; color: #fff; border-radius: 20px; font-size: 15px; outline: none;}
    #searchInput::placeholder { color: #aaa; }
    .floater-ticker {background: #d0eaff; color: #1a1a2e; padding: 10px 0; overflow: hidden; white-space: nowrap;border-bottom: 2px solid #a0caff; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);}
    .floater-content {display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite;font-weight: bold; font-size: 15px;}
    @keyframes marquee {0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); }}
    .tabs{display:flex;overflow-x:auto;padding:10px 0;background:#fff;border-bottom:2px solid #eee;box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);}
    .tabs button{padding:10px 16px; border:none; background:#f0f0f5; margin:0 4px;cursor:pointer; border-radius:20px; font-weight:bold; color:#555;transition: background 0.3s, color 0.3s; flex-shrink: 0;}
    .tabs button.active{background:#e60023; color:#fff; box-shadow: 0 2px 8px rgba(230, 0, 35, 0.4);}
    .container {padding: 10px 0;}
    .grid {display: grid;grid-template-columns: 1fr;gap: 30px;padding: 0 20px;} /* এখানে পরিবর্তন করা হয়েছে */
    .card{background:#fff; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.1); overflow:hidden; transition: transform 0.3s, box-shadow 0.3s; position: relative;}
    .card-image-wrapper{position: relative; height: 275px; overflow: hidden; border-top-left-radius: 0; border-top-right-radius: 0;}
    .card-image-wrapper img{width:100%; height:110%; object-fit:cover; display:block;}

    /* === পরিবর্তিত কার্ড টাইটেল স্টাইল === */
    .card-title {
        font-size: 18px; font-weight: bold; color: #1a1a2e;
        margin-bottom: 8px;
        padding: 10px 15px 0 15px; /* আগের কোড */
        white-space: normal; display: -webkit-box;-webkit-line-clamp: 2;
        -webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;
    }
    .card-body{padding:0 15px 15px 15px; padding-top: 0;}
    /* ============================ */

    .card-desc{font-size:14px;color:#777;margin-bottom:15px; font-weight: 500;display: flex;justify-content: space-between; align-items: center;}
    .unlock-btn,.watch-btn{width:100%; padding:12px; font-size:16px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; transition: background 0.3s, transform 0.2s;}
    .unlock-btn{background: linear-gradient(to right, #6a11cb, #2575fc);color:#fff;box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);}
    .unlock-btn:hover {transform: translateY(-2px);box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);}
    .watch-btn{background:#e60023; color:#fff;}
    .sidebar{position:fixed; top:0; left:-300px; width:280px; height:100%; background:#fff; z-index:1100; padding:0; display: flex; flex-direction: column; box-shadow: 4px 0 20px rgba(0,0,0,0.4); transition:left 0.3s ease-in-out;}
    .sidebar.active{left:0;}

    .sidebar-header{
        font-size: 20px; font-weight: bold; color: #fff;
        background: #333; /* কালো ব্যাকগ্রাউন্ড */
        padding: 15px 25px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex; justify-content: space-between; align-items: center;
    }
    .sidebar-close-btn {
        background: none; border: none; color: #e60023; /* গাঢ় লাল রঙ */
        font-size: 30px; font-weight: 900; /* আরও বোল্ড */
        cursor: pointer; padding: 0; line-height: 1;
    }

    .sidebar-links {padding: 20px 15px; /* flex-grow সরানো হয়েছে */}
    .sidebar-links a {
        display: block; padding: 12px 15px; color: #0056b3;
        text-decoration: none; margin-bottom: 10px; border-radius: 20px;
        font-weight: bold; transition: all 0.2s ease-in-out;
        background: #eaf6ff; text-align: center; border: 1px solid #cce7ff;
    }
    .sidebar-links a:hover {
        background: #d0eaff; color: #003a75;
        transform: scale(1.03); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .sidebar-links a.active-link {
        background: #e60023 !important; color: #fff !important;
        box-shadow: 0 2px 5px rgba(230, 0, 35, 0.3); transform: none !important;
    }

    .sidebar-follow-header {
        background: #333; color: #fff; font-size: 16px;
        font-weight: bold; padding: 10px 25px;
        margin-top: 15px; /* উপরের মেনু থেকে দূরত্ব */
    }
    .sidebar-follow-links {padding: 15px; padding-bottom: 0;}
    .sidebar-follow-links a {
        background: #fff8e1; /* হালকা হলুদ ব্যাকগ্রাউন্ড */
        color: #c58900;
        border: 1px solid #ffecb3;
    }
    .sidebar-follow-links a:hover {
        background: #ffecb3; /* হোভারে গাঢ় হলুদ */
        color: #8c5d00;
    }

    .sidebar-footer {
        padding: 15px; border-top: 1px solid #eee;
        margin-top: auto; /* ফুটারকে নিচে রাখার জন্য */
    }
    .sidebar-back-btn {width: 100%; padding: 10px; background: #e60023; color: #fff;border: none; border-radius: 8px; font-weight: bold; cursor: pointer;transition: background 0.2s;}
    .sidebar-back-btn:hover { background: #cc001f; }
    .close-sidebar { display: none; }
    .modal{position:fixed;top:0;left:0;width:100%;height:100%; background:rgba(0,0,0,0.7); display:none;align-items:center; justify-content:center; z-index:1000; opacity: 0; transition:opacity 0.3s;}
    #termsModal.active{z-index: 9999 !important; opacity: 1; display: flex;}
    .modal.active{opacity: 1; display: flex;}
    .modal-content{background:#fff; border-radius:15px; max-width:400px; width:90%; padding:30px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform:scale(0.8); transition:all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; max-height: 80vh; overflow-y: auto;}
    .modal.active .modal-content{transform:scale(1);}
    #privacyModal .modal-content h2 {color: #0088cc;}
    #termsModal .modal-content h2 {color: #e60023;}
    #rulesModal .modal-content h2 {color: #e60023;}
    .modal-content button {padding: 12px 25px; border: none;border-radius: 8px;font-weight: bold;cursor: pointer;transition: background 0.3s, transform 0.2s;margin-top: 20px; font-size: 16px;min-width: 120px;}
    .close-btn {background: #f0f0f5;color: #555;margin-right: 15px;}
    .close-btn:hover {background: #ddd;transform: translateY(-2px);}
    .buy-btn, .accept-btn {background: #e60023;color: #fff;}
    .buy-btn:hover, .accept-btn:hover {background: #cc001f;transform: translateY(-2px);}
    #termsModal .modal-content p, #rulesModal .modal-content p {text-align: justify; font-size: 14px; color: #333; line-height: 1.6; margin-bottom: 15px;}
    .pagination {display: flex;flex-wrap: wrap;justify-content: center;padding: 20px 0;margin-top: 10px;}
    .page-btn {padding: 8px 14px;margin: 0 5px;border: 1px solid #ddd;background: #fff;color: #555;border-radius: 6px;cursor: pointer;font-weight: bold;transition: background 0.2s, color 0.2s;}
    .page-btn.active {background: #e60023;color: #fff;border-color: #e60023;}
    .page-btn:hover:not(.active) {background: #f0f0f5;}
    .pagination-footer {text-align: center;margin: -10px 0 20px 0;font-weight: bold;color: #e60023;}
    .skeleton-card {background: #fff; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.05); padding: 0; overflow: hidden;}
    .skeleton-image {height: 240px; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite;}
    .skeleton-text {height: 14px; margin-bottom: 8px; border-radius: 4px; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite;}
    .skeleton-text.short { width: 60%; }
    .skeleton-text.button { height: 40px; margin-top: 15px; }
    @keyframes loading {0% { background-position: 200% 0; } 100% { background-position: -200% 0; }}
    .skeleton-card .card-body { padding: 15px; }
    .progress-bar-container {margin-bottom: 20px;padding: 0 10px;}
    .progress-header {display: flex;justify-content: space-between;align-items: center;margin-bottom: 8px;}
    .progress-text {font-size: 15px;font-weight: bold;color: #1a1a2e;}
    .rules-menu-btn {background: none;border: none;font-size: 24px;color: #555;cursor: pointer;padding: 0 5px;font-weight: bold;}
    .progress-bar-wrapper {width: 100%;background: #fff;border-radius: 20px;height: 14px;overflow: hidden;box-shadow: inset 0 1px 3px rgba(0,0,0,0.15);}
    .progress-bar-fill {height: 100%;background: linear-gradient(to right, #8000ff, #e60023);border-radius: 20px;transition: width 0.5s ease-in-out;}
    #unlockSuccessModal .modal-content {border-top: 5px solid #28a745;}
    #unlockSuccessModal .modal-content h2 {color: #28a745;font-size: 24px;}
    #unlockSuccessModal .modal-content p {font-size: 16px;color: #333;margin-top: 15px;margin-bottom: 25px;}
    #unlockSuccessModal .ok-btn {background: #28a745;color: #fff;}
    #unlockSuccessModal .ok-btn:hover {background: #218838;}
  </style>
</head>
<body>
    <header>
        <button id="globalMenuBtn" class="global-menu-btn">≡</button>
        <input type="search" id="searchInput" placeholder="ভিডিও খুঁজুন...">
    </header>

    <div class="floater-ticker" id="floaterTicker" style="display: none;">
        <div class="floater-content" id="floaterContent">আনলক বাটনে ক্লিক করে ভিডিও গুলো আনলক করুন এবং সকল প্রিমিয়াম ভিডিও গুলো ফ্রিতে উপভোগ করুন।  </div>
    </div>

    <div class="tabs" id="tabs" style="display: none;"></div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="progress-bar-container">
            <div class="progress-header">
                <span id="progressBarText" class="progress-text"></span>
                <button id="rulesMenuBtn" class="rules-menu-btn" onclick="openRulesModal()">&#8942;</button>
            </div>
            <div class="progress-bar-wrapper">
                <div id="progressBarFill" class="progress-bar-fill" style="width: 0%;"></div>
            </div>
        </div>
        <div id="list" class="grid"></div>
        <div id="pagination" class="pagination"></div>
        <div id="paginationFooterText" class="pagination-footer"></div>
    </div>

    <!-- === পরিবর্তিত সাইডবার HTML === -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span>Main Menu</span>
            <button class="sidebar-close-btn" onclick="closeSidebar()">×</button>
        </div>

        <div class="sidebar-links">
            <a href="#" id="premiumLink" onclick="openPremiumModal(this)">Premium Offer</a>
            <a href="#" id="privacyLink" onclick="openPrivacyModal(this)">Privicy Policy </a>
            <a href="#" id="aboutLink" onclick="openAboutModal(this)">About</a>
            <a href="https://t.me/Rx_Admin9" target="_blank">📞 Contract Us</a>
        </div>

        <!-- ফলো সেকশনকে উপরে আনা হয়েছে -->
        <div class="sidebar-follow-header">Follow Our Community</div>
        <div class="sidebar-links sidebar-follow-links">
            <a href="https://t.me/+L4ax5AFi6MNlOWM1" target="_blank">Telegram</a>
            <a href="https://otieu.com/4/9873659" target="_blank">🔞 18+ Website </a>
            <a href="https://yourwebsite.com" target="_blank">Youtube</a>
        </div>

        <div class="sidebar-footer">
            <button class="sidebar-back-btn" onclick="closeSidebar()">পেছনে যান</button>
        </div>
    </div>
    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>
    <!-- ===================================== -->

    <!-- Modals -->
    <div class="modal" id="premiumModal"> <div class="modal-content"> <h2>প্রিমিয়াম সুবিধা</h2> <p style="text-align: left; font-size: 16px; margin-bottom: 25px; color: #1a1a2e; line-height: 1.6;"> <strong style="color: #8000ff;">প্রিমিয়াম প্যাকেজে যা আছে:</strong> <ul style="list-style: none; padding: 10px 0 0 15px;"> <li style="margin-bottom: 8px; border-bottom: 1px solid #eee;">৩০০০+ ভাইরাল ভিডিও</li> <li style="margin-bottom: 8px; border-bottom: 1px solid #eee;">প্রতিদিন ৫০+ নতুন আপলোড ও HD কনটেন্ট</li> <li style="margin-bottom: 8px; border-bottom: 1px solid #eee;">বিজ্ঞাপন বিহীন অভিজ্ঞতা </li> <li style="margin-bottom: 8px;">বাছাই করা সকল ক্যাটাগরীর কন্টেন্ট</li> </ul> </p> <button class="close-btn" onclick="closePremiumModal()">বন্ধ</button> <button class="buy-btn" onclick="window.open('https://t.me/Rx_Admin9', '_blank')">কিনুন</button> </div> </div>
    <div class="modal" id="privacyModal"> <div class="modal-content"> <h2>প্রাইভেসি পলিসি</h2> <p>আমরা ব্যবহারকারীর ব্যক্তিগত তথ্য গুরুত্ব দিয়ে রাখি। সাইটে কুকি/লোকালস্টোরেজ ব্যবহার করা হতে পারে — শুধুমাত্র সাইটের কার্যকারিতা নিশ্চিত করার জন্য।</p> <button class="close-btn" onclick="closePrivacyModal()">বন্ধ</button> </div> </div>
    <div class="modal" id="aboutModal"> <div class="modal-content"> <h2>আমাদের সম্পর্কে</h2> <p style="text-align: justify; font-size: 14px; color: #555; line-height: 1.6;"> <strong>Viral Video Zone</strong> হল একটি ১৮+ ভাইরাল ভিডিও শেয়ার প্ল্যাটফর্ম। এখানে আপনি বিভিন্ন ক্যাটাগরির ভিডিও দেখতে পারবেন, প্রিমিয়াম প্যাকেজে অতিরিক্ত সুবিধা পাবেন, এবং নিয়মিত নতুন কনটেন্ট আপলোড করা হবে। সাইটটি ব্যবহার করার আগে টার্মস অ্যান্ড কন্ডিশন মেনে চলুন। </p> <button class="close-btn" onclick="closeAboutModal()">বন্ধ</button> </div> </div>
    <div class="modal" id="termsModal"> <div class="modal-content"> <h2>শর্তাবলী ও নীতিমালা</h2> <div style="max-height: 300px; overflow-y: auto; padding-right: 10px; padding-top: 10px;"> <p>১. ব্যবহারকারীরা সাইটে পোস্ট করা কনটেন্ট কপি বা ডাউনলোড করার আগে কপিরাইট নীতিমালা মেনে চলবে।</p> <p>২. সাইট ব্যবহারে কোনো অবৈধ কার্যকলাপে অংশগ্রহণ করা যাবে না। নিয়ম ভঙ্গ করলে অ্যাক্সেস ব্লক করা যেতে পারে।</p> <p>৩. প্রিমিয়াম সার্ভিস ফেরত নীতিমালা ও ব্যবহার শর্ত প্রযোজ্য। বিস্তারিত পড়ুন এবং সম্মতি দিন।</p> <p>৪. আমরা লোকাল স্টোরেজ ব্যবহার করে ব্যবহারকারীর আনলক স্টেট মেইনটেইন করি। প্রয়োজনে সেটি রিসেট হবে।</p> </div> <button class="accept-btn" onclick="acceptTermsAndEnterSite()">আমি গ্রহণ করছি</button> </div> </div>
    <div class="modal" id="rulesModal"> <div class="modal-content"> <h2>নিয়মাবলী</h2> <p> আপনি যদি ১৫ টি ভিডিও দেখেন তাহলে আপনি পরবর্তী ২৪ ঘন্টার জন্য সকল ভিডিও বিজ্ঞাপন বিহীন উপভোগ করতে পারবেন।</p> <ul style="text-align: left; padding-left: 20px; font-size: 14px; color: #333;"></li> </ul> <button class="close-btn" onclick="closeRulesModal()">বন্ধ</button> </div> </div>
    <div class="modal" id="unlockSuccessModal"> <div class="modal-content"> <h2>অভিনন্দন!</h2> <p>আপনি ২৪ ঘন্টার জন্য সকল ভিডিও আনলক করেছেন, তাই এখন সকল ভিডিও বিজ্ঞাপন ছাড়া উপভোগ করুন।</p> <button class="ok-btn" onclick="closeUnlockSuccessModal()">ঠিক আছে</button> </div> </div>

    <script src="//libtl.com/sdk.js" data-zone="9916018" data-sdk="show_9916018" defer></script>

<script>
    // জাভাস্ক্রিপ্ট কোড অপরিবর্তিত আছে
    const VIDEOS_PER_PAGE = 5;
    let activeCategory = "";
    let currentPage = 1;
    let allVideosData = {};
    let updateInterval;

    const GLOBAL_UNLOCK_KEY = 'global_unlock_until';
    const DAILY_UNLOCK_COUNT_KEY = 'daily_unlock_count';
    const DAILY_UNLOCK_LIMIT = 15;
    const UNLOCK_DURATION = 24 * 60 * 60 * 1000;

    document.addEventListener("DOMContentLoaded", () => {
        const listDiv = document.getElementById("list");
        listDiv.innerHTML = createSkeletonLoader(VIDEOS_PER_PAGE);

        fetch('database.json')
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                allVideosData = data;
                showTermsModal();
            })
            .catch(error => {
                console.error('Error fetching video data:', error);
                listDiv.innerHTML = '<p style="text-align:center; color: red; padding: 20px;">ডেটা ফাইল লোড করতে সমস্যা হয়েছে। ফাইলটি সঠিক জায়গায় আছে কিনা পরীক্ষা করুন।</p>';
            });

        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', handleSearch);
    });

    function storageKey(link){return 'unlock_'+encodeURIComponent(link);}
    function getState(link){try{const raw=localStorage.getItem(storageKey(link));if(!raw) return {unlockedUntil:0};const obj=JSON.parse(raw);if(obj.unlockedUntil && Date.now()>obj.unlockedUntil) return {unlockedUntil:0};return obj;}catch(e){return {unlockedUntil:0};}}
    function setState(link,state){localStorage.setItem(storageKey(link),JSON.stringify(state));}
    function isGloballyUnlocked() {const until = localStorage.getItem(GLOBAL_UNLOCK_KEY);return until && Date.now() < parseInt(until);}
    function getDailyCount() {const raw = localStorage.getItem(DAILY_UNLOCK_COUNT_KEY);if (!raw) return { count: 0, date: new Date().toDateString() };const obj = JSON.parse(raw);if (obj.date !== new Date().toDateString()) {return { count: 0, date: new Date().toDateString() };}return obj;}

    function incrementDailyCount(link) {
        let state = getDailyCount();
        if (isGloballyUnlocked()) return;
        state.count++;
        state.date = new Date().toDateString();
        localStorage.setItem(DAILY_UNLOCK_COUNT_KEY, JSON.stringify(state));
        updateProgressBar();
        if (state.count >= DAILY_UNLOCK_LIMIT) {
            localStorage.setItem(GLOBAL_UNLOCK_KEY, Date.now() + UNLOCK_DURATION);
            setTimeout(() => {
                openUnlockSuccessModal();
                switchTab(activeCategory, currentPage);
            }, 100);
        }
    }

    const tabsDiv=document.getElementById("tabs");
    const listDiv=document.getElementById("list");
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const globalMenuBtn = document.getElementById("globalMenuBtn");
    globalMenuBtn.onclick = openSidebar;

    function setActiveLink(element = null) {document.querySelectorAll('.sidebar-links a').forEach(a => {if (!a.hasAttribute('onclick')) return;a.classList.remove('active-link');});if (element) {element.classList.add('active-link');}}
    function openSidebar() {sidebar.classList.add("active");overlay.style.display = 'block';}
    function closeSidebar() {sidebar.classList.remove("active");overlay.style.display = 'none';}
    function openModal(modalId, element = null) {if (element) setActiveLink(element);closeSidebar();const modal = document.getElementById(modalId);modal.classList.add("active");}
    function closeModal(modalId, linkId = null) {const modal = document.getElementById(modalId);modal.classList.remove("active");if (linkId) {document.getElementById(linkId).classList.remove('active-link');}}
    function openPremiumModal(element){ openModal("premiumModal", element); }
    function closePremiumModal(){ closeModal("premiumModal", "premiumLink"); }
    function openPrivacyModal(element){ openModal("privacyModal", element); }
    function closePrivacyModal(){ closeModal("privacyModal", "privacyLink"); }
    function openAboutModal(element){ openModal("aboutModal", element); }
    function closeAboutModal(){ closeModal("aboutModal", "aboutLink"); }
    function openRulesModal(){ openModal("rulesModal"); }
    function closeRulesModal(){ closeModal("rulesModal"); }
    function openUnlockSuccessModal(){ openModal("unlockSuccessModal"); }
    function closeUnlockSuccessModal(){ closeModal("unlockSuccessModal"); }

    function startSite(){
        document.body.style.overflow = 'auto';
        document.getElementById("floaterTicker").style.display = 'block';
        document.getElementById("tabs").style.display = 'flex';
        document.getElementById("mainContent").style.display = 'block';
        updateProgressBar();
        loadCategoriesAndTabs();
        startAutoTimeUpdate();
    }

    function showTermsModal(){
        if (localStorage.getItem('terms_accepted') !== 'true') {
            const modal = document.getElementById("termsModal");
            modal.classList.add("active");
            document.body.style.overflow = 'hidden';
        } else {
            startSite();
        }
    }

    function acceptTermsAndEnterSite(){
        localStorage.setItem('terms_accepted', 'true');
        closeModal("termsModal");
        startSite();
    }

    function loadCategoriesAndTabs() {
        tabsDiv.innerHTML = '';
        let categories = Object.keys(allVideosData);
        categories.unshift("All");
        categories.forEach(cat => {
            const btn = document.createElement("button");
            btn.innerText = cat;
            btn.onclick = () => switchTab(cat);
            tabsDiv.appendChild(btn);
        });
        if (categories.length > 0) {
            switchTab(categories[0]);
        }
    }

    function switchTab(cat, page = 1){
        document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
        const activeTab = [...document.querySelectorAll(".tabs button")].find(b=>b.innerText===cat);
        if(activeTab) activeTab.classList.add("active");
        activeCategory = cat;
        currentPage = page;
        renderList(cat, currentPage);
    }

    function handleSearch(event) {
        const query = event.target.value.toLowerCase().trim();

        if (query === "") {
            switchTab(activeCategory, currentPage);
            return;
        }

        let filteredVideos = [];
        for (const category in allVideosData) {
            allVideosData[category].forEach(video => {
                if (video.title.toLowerCase().includes(query)) {
                    filteredVideos.push(video);
                }
            });
        }

        document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
        document.getElementById('pagination').innerHTML = "";
        document.getElementById('paginationFooterText').innerText = "";

        renderGrid(filteredVideos);
    }

    async function showAd(){if(typeof show_9916018==="function"){try{await show_9916018();await new Promise(resolve => setTimeout(resolve, 500));}catch(e){await new Promise(resolve => setTimeout(resolve, 300));}} else {alert("বিজ্ঞাপন লোড করা সম্ভব হয়নি — প্লেয়ারটি খোলা হচ্ছে।");}}
    function generateRandomViews() {const views = Math.floor(Math.random() * (900 - 50)) + 50;const unit = ['K', 'M'][Math.floor(Math.random() * 2)];return (views / 10).toFixed(1) + unit;}
    function timeAgo(uploadTimeStr) {const uploadTime = new Date(uploadTimeStr);const now = new Date();const diffMs = now.getTime() - uploadTime.getTime();const seconds = Math.floor(diffMs / 1000);const minutes = Math.floor(seconds / 60);const hours = Math.floor(minutes / 60);const days = Math.floor(hours / 24);if (seconds < 60) return `${seconds} সেকেন্ড আগে`;if (minutes < 60) return `${minutes} মিনিট আগে`;if (hours < 24) return `${hours} ঘন্টা আগে`;return `${days} দিন আগে`;}
    function startAutoTimeUpdate() {if (updateInterval) clearInterval(updateInterval);updateInterval = setInterval(updateAllCardTimes, 60000);}
    function updateAllCardTimes() {document.querySelectorAll('.upload-time-span').forEach(span => {const uploadTime = span.getAttribute('data-upload-time');if (uploadTime) span.innerText = `আপলোড: ${timeAgo(uploadTime)}`;});}

    function createSkeletonLoader(count) {
        let loaderHTML = '';
        for (let i = 0; i < count; i++) {
            loaderHTML += `
                <div class="skeleton-card">
                    <div class="skeleton-image"></div>
                    <div class="card-body">
                        <div class="skeleton-text" style="width: 90%;"></div>
                        <div class="skeleton-text short"></div>
                        <div class="skeleton-text button"></div>
                    </div>
                </div>`;
        }
        return loaderHTML;
    }

    function renderGrid(data){
        listDiv.innerHTML = "";
        if (data.length === 0) {
            listDiv.innerHTML = '<p style="text-align:center; color:#555; font-size:1.1em; padding: 20px;">এই ক্যাটাগরি বা সার্চে কোনো ভিডিও নেই।</p>';
            return;
        }
        const isUnlockedGlobally = isGloballyUnlocked();
        data.sort((a, b) => new Date(b.uploadTime) - new Date(a.uploadTime));
        data.forEach(v=>{
            const card=document.createElement("div"); card.className="card";
            const friendlyTime = timeAgo(v.uploadTime);
            const views = v.views || generateRandomViews();
            const videoUnlocked = getState(v.link).unlockedUntil > 0 || isUnlockedGlobally;
            // === কার্ডের HTML এ টাইটেলকে বডির বাইরে আনা হয়েছে ===
            card.innerHTML=`
                <div class="card-image-wrapper"><img src="${v.img}" alt="${v.title}" loading="lazy"></div>
                <div class="card-title">${v.title}</div>
                <div class="card-body">
                    <div class="card-desc">
                        <span class="upload-time-span" data-upload-time="${v.uploadTime}">আপলোড: ${friendlyTime}</span>
                        <span>ভিউ: ${views}</span>
                    </div>
                    ${videoUnlocked
                        ? `<button class="watch-btn" onclick="watchVideo('${v.link}')">Watch Now</button>`
                        : `<button class="unlock-btn" onclick="unlockVideo('${encodeURIComponent(v.link)}')">🔓 Unlock Video</button>`
                    }
                </div>`;
            listDiv.appendChild(card);
        });
        updateAllCardTimes();
    }

    function renderList(category, page = 1) {
        let allData = [];
        if (category === "All") {
            for (const catKey in allVideosData) {
                allData.push(...allVideosData[catKey]);
            }
        } else {
            allData = allVideosData[category] || [];
        }
        allData.sort((a, b) => new Date(b.uploadTime) - new Date(a.uploadTime));
        const totalPages = Math.ceil(allData.length / VIDEOS_PER_PAGE);
        const paginatedData = allData.slice((page - 1) * VIDEOS_PER_PAGE, page * VIDEOS_PER_PAGE);
        renderGrid(paginatedData);
        renderPagination(totalPages, page);
    }

    function renderPagination(totalPages, currentPage) {
        const paginationDiv = document.getElementById("pagination");
        const paginationFooter = document.getElementById('paginationFooterText');
        paginationDiv.innerHTML = "";
        if (totalPages <= 1) {
            paginationFooter.innerText = "";
            return;
        }
        if (currentPage > 1) {
            const prevBtn = document.createElement("button");
            prevBtn.className = "page-btn";
            prevBtn.innerText = "পেছনে";
            prevBtn.onclick = () => switchTab(activeCategory, currentPage - 1);
            paginationDiv.appendChild(prevBtn);
        }
        const btn = document.createElement("button");
        btn.className = "page-btn active";
        btn.innerText = currentPage;
        paginationDiv.appendChild(btn);
        if (currentPage < totalPages) {
            const nextBtn = document.createElement("button");
            nextBtn.className = "page-btn";
            nextBtn.innerText = "পরের পেজ";
            nextBtn.onclick = () => switchTab(activeCategory, currentPage + 1);
            paginationDiv.appendChild(nextBtn);
        }
        paginationFooter.innerText = (currentPage < totalPages) ? "➡️ আরও ভিডিও দেখতে পরের পেজে যান।" : "";
    }

    async function unlockVideo(encodedLink){
        const link = decodeURIComponent(encodedLink);
        if(getState(link).unlockedUntil > 0 || isGloballyUnlocked()){
            watchVideo(link);
            return;
        }
        await showAd();
        setState(link, {unlockedUntil: Date.now() + UNLOCK_DURATION});
        incrementDailyCount(link);
        const currentSearch = document.getElementById('searchInput').value;
        if (currentSearch.trim() !== '') {
            handleSearch({ target: { value: currentSearch } });
        } else {
            switchTab(activeCategory, currentPage);
        }
    }

    function watchVideo(link){
        if(getState(link).unlockedUntil > 0 || isGloballyUnlocked()){
            window.open(link, '_blank');
        } else {
            alert("ভিডিও দেখার জন্য প্রথমে আনলক করুন।");
        }
    }

    function updateProgressBar() {
        const progressBarFill = document.getElementById('progressBarFill');
        const progressBarText = document.getElementById('progressBarText');
        const currentCount = getDailyCount().count;
        const progressPercentage = (currentCount / DAILY_UNLOCK_LIMIT) * 100;

        if (isGloballyUnlocked()) {
            progressBarText.innerText = `২৪ ঘন্টার জন্য সকল ভিডিও আনলক হয়েছে`;
            progressBarFill.style.width = `100%`;
        } else {
            const remainingPercentage = 100 - progressPercentage;
            progressBarText.innerText = `সকল ভিডিও আনলক হতে বাকি ${Math.floor(remainingPercentage)}%`;
            progressBarFill.style.width = `${progressPercentage}%`;
        }
    }
</script>
</body>
</html>