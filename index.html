<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>প্রিমিয়াম অ্যাডমিন প্যানেল</title>
    <!-- Google Fonts & Font Awesome Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6A11CB; /* Deeper Purple */
            --primary-hover: #4F009B;
            --danger-color: #FF4B5C; /* Vibrant Red */
            --danger-hover: #E03548;
            --secondary-color: #6B7280;
            --secondary-hover: #4B5563;
            --bg-light: #F0F2F5; /* Lighter Grey Blue */
            --bg-dark: #2C3E50; /* Darker Blue Grey */
            --text-light: #ECF0F1; /* Off-White */
            --text-dark: #2C3E50;
            --border-color: #DDE1E6;
            --card-bg: #FFFFFF;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --input-focus-border: #8A52F8;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-light); color: var(--text-dark); line-height: 1.6; }

        /* Login Page */
        #login-container { display: flex; justify-content: center; align-items: center; height: 100vh; background-image: linear-gradient(135deg, #A8C0FF, #392F8A); }
        .login-box { background: var(--card-bg); padding: 40px; border-radius: 12px; box-shadow: var(--shadow); text-align: center; width: 90%; max-width: 400px; }
        .login-box h2 { margin-bottom: 25px; color: var(--primary-color); font-size: 28px; }
        .login-box input { width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        .login-box input:focus { border-color: var(--input-focus-border); outline: none; box-shadow: 0 0 0 3px rgba(138, 82, 248, 0.2); }
        .login-box button { width: 100%; padding: 14px; border: none; background-image: linear-gradient(45deg, var(--primary-color), #8A52F8); color: white; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 18px; transition: all 0.3s ease; }
        .login-box button:hover { transform: translateY(-2px); box-shadow: var(--shadow); opacity: 0.9; }
        .error-message { color: var(--danger-color); margin-top: 10px; height: 20px; font-size: 14px; }

        /* Dashboard Layout */
        #dashboard-wrapper { display: flex; }
        
        .sidebar {
            background: var(--bg-dark); color: var(--text-light); width: 280px; height: 100vh;
            position: fixed; top: 0; left: 0; z-index: 1001;
            display: flex; flex-direction: column; padding: 20px 0;
            transform: translateX(-100%); transition: transform 0.3s ease-in-out;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .sidebar.open { transform: translateX(0); }
        .sidebar-header { text-align: center; margin-bottom: 30px; font-size: 24px; font-weight: 700; color: var(--text-light); padding: 0 20px; }
        .sidebar-menu { list-style: none; flex-grow: 1; }
        .sidebar-menu li a { color: var(--text-light); text-decoration: none; display: flex; align-items: center; padding: 15px 25px; border-radius: 0 30px 30px 0; margin-bottom: 8px; transition: all 0.3s ease; position: relative; }
        .sidebar-menu li a:hover { background-color: rgba(255, 255, 255, 0.15); transform: translateX(5px); }
        .sidebar-menu li a.active { background-image: linear-gradient(90deg, #8A52F8, var(--primary-color)); box-shadow: var(--shadow); color: white; }
        .sidebar-menu li a i { margin-right: 18px; width: 22px; text-align: center; font-size: 18px; }
        .logout-section { margin-top: 20px; padding: 0 20px; }
        #logout-btn { background-image: linear-gradient(45deg, var(--danger-color), #FF7B87); color: white; border: none; width: 100%; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 16px; transition: all 0.3s ease; }
        #logout-btn:hover { transform: translateY(-2px); box-shadow: var(--shadow); opacity: 0.9; }

        .main-header {
            background: var(--card-bg); padding: 15px 20px;
            display: flex; align-items: center; box-shadow: var(--shadow);
            position: sticky; top: 0; z-index: 999;
            border-bottom: 1px solid var(--border-color);
        }
        #menu-toggle-btn { background: none; border: none; font-size: 28px; cursor: pointer; color: var(--text-dark); }
        .header-title { font-size: 22px; font-weight: 600; margin-left: 15px; color: var(--text-dark); }

        .main-content { width: 100%; padding: 20px; transition: margin-left 0.3s ease-in-out; }
        .card { background: var(--card-bg); border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 30px; padding: 25px; }
        .card h2 { color: var(--primary-color); border-bottom: 2px solid var(--border-color); padding-bottom: 15px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; font-size: 22px; font-weight: 600; }
        
        /* Overlay for mobile sidebar */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .overlay.active { display: block; }
        
        /* Desktop styles */
        @media (min-width: 992px) {
            .sidebar { transform: translateX(0); }
            .main-content { margin-left: 280px; padding: 30px; }
            #menu-toggle-btn { display: none; }
            .header-title { margin-left: 0; }
            .main-header { display: none; } /* Hide header on desktop */
        }
        
        /* Other styles */
        .analytics-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 576px) { .analytics-grid { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); } }
        .analytic-item { background-color: #EAF0F7; /* Light Blue-Grey */ padding: 25px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .analytic-item h3 { font-size: 18px; color: var(--secondary-color); font-weight: 500; margin-bottom: 12px; border: none; padding: 0; }
        .analytic-item span { font-size: 32px; font-weight: 700; color: var(--primary-color); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 10px; font-weight: 500; color: var(--text-dark); font-size: 15px; }
        .form-control { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; transition: border-color 0.3s, box-shadow 0.3s; }
        .form-control:focus { border-color: var(--input-focus-border); outline: none; box-shadow: 0 0 0 3px rgba(138, 82, 248, 0.2); }
        textarea.form-control { min-height: 100px; resize: vertical; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease; }
        .btn-primary { background-image: linear-gradient(45deg, var(--primary-color), #8A52F8); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow); opacity: 0.9; }
        .btn-secondary { background-color: var(--secondary-color); color: white; }
        .btn-secondary:hover { background-color: var(--secondary-hover); transform: translateY(-2px); }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-danger:hover { background-color: var(--danger-hover); transform: translateY(-2px); }
        .category-actions { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; }
        .video-item { display: flex; flex-direction: column; align-items: flex-start; gap: 10px; padding: 18px 15px; border-bottom: 1px solid var(--border-color); background: #FDFDFD; border-radius: 8px; margin-bottom: 10px; transition: background-color 0.2s; }
        .video-item:hover { background-color: #F8F8F8; }
        .video-item p { margin: 0; font-weight: 500; font-size: 16px; color: var(--text-dark); }
        @media (min-width: 576px) { .video-item { flex-direction: row; align-items: center; } .video-item p { flex-grow: 1; } }
        .video-item-actions { display: flex; gap: 10px; }
        .action-btn { background: none; border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .action-btn:hover { background-color: var(--bg-light); }
        .action-btn.edit { color: var(--primary-color); border-color: var(--primary-color); }
        .action-btn.edit:hover { background-color: rgba(106, 17, 203, 0.1); }
        .action-btn.delete { color: var(--danger-color); border-color: var(--danger-color); }
        .action-btn.delete:hover { background-color: rgba(255, 75, 92, 0.1); }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1002; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { background-color: #fff; margin: auto; padding: 30px; border-radius: 12px; width: 90%; max-width: 550px; box-shadow: var(--shadow); animation: fadeInScale 0.3s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 25px; }
        .modal-header h2 { margin: 0; font-size: 24px; color: var(--primary-color); }
        .close-btn { font-size: 30px; cursor: pointer; color: var(--secondary-color); background: none; border: none; transition: color 0.2s; }
        .close-btn:hover { color: var(--text-dark); }
        .modal-footer { text-align: right; margin-top: 30px; }
    </style>
</head>
<body>
    <div id="login-container">
        <div class="login-box">
            <h2>অ্যাডমিন লগইন</h2>
            <input type="email" id="email" placeholder="ইমেইল" required>
            <input type="password" id="password" placeholder="পাসওয়ার্ড" required>
            <button id="login-btn">লগইন করুন</button>
            <p id="login-error" class="error-message"></p>
        </div>
    </div>

    <div id="dashboard-wrapper" style="display: none;">
        <div class="overlay"></div>
        <nav class="sidebar">
            <div class="sidebar-header"><h2>অ্যাডমিন প্যানেল</h2></div>
            <ul class="sidebar-menu">
                <li><a href="#analytics-section" class="active"><i class="fas fa-chart-line"></i> অ্যানালিটিক্স</a></li>
                <li><a href="#settings-section"><i class="fas fa-cogs"></i> সাইট সেটিংস</a></li>
                <li><a href="#links-section"><i class="fas fa-link"></i> মেনু লিংক</a></li>
                <li><a href="#video-section"><i class="fas fa-video"></i> ভিডিও ম্যানেজমেন্ট</a></li>
            </ul>
            <div class="logout-section"><button id="logout-btn"><i class="fas fa-sign-out-alt"></i> লগআউট</button></div>
        </nav>
        
        <div style="width: 100%;">
            <header class="main-header">
                <button id="menu-toggle-btn"><i class="fas fa-bars"></i></button>
                <h1 class="header-title">ড্যাশবোর্ড</h1>
            </header>
            <main class="main-content">
                <section id="analytics-section" class="card">
                    <h2><i class="fas fa-chart-line"></i> সাইট অ্যানালিটিক্স</h2>
                    <div class="analytics-grid">
                        <div class="analytic-item"><h3>মোট ব্যবহারকারী</h3><span id="total-users">0</span></div>
                        <div class="analytic-item"><h3>মোট অ্যাড ক্লিক</h3><span id="total-clicks">0</span></div>
                        <div class="analytic-item"><h3>আজকের অ্যাড ক্লিক</h3><span id="today-clicks">0</span></div>
                    </div>
                </section>
                
                <section id="settings-section" class="card" style="display: none;">
                    <h2><i class="fas fa-cogs"></i> সাইট সেটিংস</h2>
                    <div class="form-group"><label for="live-text">স্ক্রলিং টেক্সট</label><input type="text" id="live-text" class="form-control"></div>
                    <div class="form-group"><label for="zone-id">বিজ্ঞাপন জোন আইডি</label><input type="text" id="zone-id" class="form-control"></div>
                    <div class="form-group"><label for="unlock-count">ভিডিও আনলক ভিউ</label><input type="number" id="unlock-count" class="form-control"></div>
                    <div class="form-group"><label for="rules-text-input">নিয়মাবলী টেক্সট</label><textarea id="rules-text-input" class="form-control"></textarea></div>
                    <button id="save-settings-btn" class="btn btn-primary"><i class="fas fa-save"></i> সেভ করুন</button>
                </section>

                 <section id="links-section" class="card" style="display: none;">
                    <h2><i class="fas fa-link"></i> মেনু লিংক সেটিংস</h2>
                    <div class="form-group"><label for="contact-link-input">Contact Us</label><input type="url" id="contact-link-input" class="form-control"></div>
                    <div class="form-group"><label for="telegram-link-input">Telegram Community</label><input type="url" id="telegram-link-input" class="form-control"></div>
                    <div class="form-group"><label for="website18-link-input">18+ Website</label><input type="url" id="website18-link-input" class="form-control"></div>
                    <div class="form-group"><label for="youtube-link-input">Youtube</label><input type="url" id="youtube-link-input" class="form-control"></div>
                    <button id="save-links-btn" class="btn btn-primary"><i class="fas fa-save"></i> সেভ করুন</button>
                </section>

                <section id="video-section" class="card" style="display: none;">
                    <h2><i class="fas fa-video"></i> ভিডিও ম্যানেজমেন্ট</h2>
                    <div class="form-group"><label for="category-select">ক্যাটাগরি</label><select id="category-select" class="form-control"></select></div>
                    <input type="text" id="new-category-name" placeholder="নতুন ক্যাটাগরি যোগ করুন" class="form-control" style="margin-top: 10px;">
                    <div class="category-actions">
                        <button id="add-category-btn" class="btn btn-primary"><i class="fas fa-plus"></i> যোগ</button>
                        <button id="edit-category-btn" class="btn btn-secondary"><i class="fas fa-edit"></i> পরিবর্তন</button>
                        <button id="delete-category-btn" class="btn btn-danger"><i class="fas fa-trash"></i> ডিলিট</button>
                    </div>
                    <hr style="margin: 25px 0; border: none; border-top: 1px solid var(--border-color);">
                    <h3>নতুন ভিডিও যোগ করুন</h3>
                    <div class="form-group"><label for="video-title">ভিডিও টাইটেল</label><input type="text" id="video-title" class="form-control"></div>
                    <div class="form-group"><label for="image-link">ইমেজ লিংক</label><input type="text" id="image-link" class="form-control"></div>
                    <div class="form-group"><label for="video-link">ভিডিও লিংক</label><input type="text" id="video-link" class="form-control"></div>
                    <button id="add-video-btn" class="btn btn-primary"><i class="fas fa-plus-circle"></i> ভিডিও যোগ</button>
                    <hr style="margin: 25px 0; border: none; border-top: 1px solid var(--border-color);">
                    <h3>বিদ্যমান ভিডিও (<span id="current-category-name"></span>)</h3>
                    <div id="video-list">লোড হচ্ছে...</div>
                </section>
            </main>
        </div>
    </div>

    <!-- Video Edit Modal -->
    <div id="edit-video-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>ভিডিও এডিট</h2><button class="close-btn" data-modal="edit-video-modal">&times;</button></div>
            <div class="modal-body">
                <input type="hidden" id="edit-video-key"><input type="hidden" id="edit-video-category">
                <div class="form-group"><label for="edit-video-title">টাইটেল</label><input type="text" id="edit-video-title" class="form-control"></div>
                <div class="form-group"><label for="edit-image-link">ইমেজ লিংক</label><input type="text" id="edit-image-link" class="form-control"></div>
                <div class="form-group"><label for="edit-video-link">ভিডিও লিংক</label><input type="text" id="edit-video-link" class="form-control"></div>
            </div>
            <div class="modal-footer"><button id="save-video-changes-btn" class="btn btn-primary"><i class="fas fa-save"></i> সেভ</button></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Firebase Config (Replace with your actual Firebase project config)
            const firebaseConfig = {
                apiKey: "AIzaSyDwdosvSbR99tvimFcAcNUCEI_0-9EuGLk",
                authDomain: "sajid-d8f2c.firebaseapp.com",
                databaseURL: "https://sajid-d8f2c-default-rtdb.firebaseio.com",
                projectId: "sajid-d8f2c",
                storageBucket: "sajid-d8f2c.firebasestorage.app",
                messagingSenderId: "263236335013",
                appId: "1:263236335013:web:3455357757c071ec5a244c",
                measurementId: "G-K8H5TBSLEM"
            };
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.database();
            
            // All DOM Elements
            const allElements = {
                loginContainer: document.getElementById('login-container'), dashboardWrapper: document.getElementById('dashboard-wrapper'),
                loginBtn: document.getElementById('login-btn'), logoutBtn: document.getElementById('logout-btn'),
                emailInput: document.getElementById('email'), passwordInput: document.getElementById('password'),
                loginError: document.getElementById('login-error'), totalUsersSpan: document.getElementById('total-users'),
                totalClicksSpan: document.getElementById('total-clicks'), todayClicksSpan: document.getElementById('today-clicks'),
                liveTextInput: document.getElementById('live-text'), zoneIdInput: document.getElementById('zone-id'),
                unlockCountInput: document.getElementById('unlock-count'), rulesTextInput: document.getElementById('rules-text-input'),
                saveSettingsBtn: document.getElementById('save-settings-btn'),
                contactLinkInput: document.getElementById('contact-link-input'), telegramLinkInput: document.getElementById('telegram-link-input'),
                website18LinkInput: document.getElementById('website18-link-input'), youtubeLinkInput: document.getElementById('youtube-link-input'),
                saveLinksBtn: document.getElementById('save-links-btn'), categorySelect: document.getElementById('category-select'),
                newCategoryInput: document.getElementById('new-category-name'), addCategoryBtn: document.getElementById('add-category-btn'),
                editCategoryBtn: document.getElementById('edit-category-btn'), deleteCategoryBtn: document.getElementById('delete-category-btn'),
                videoTitleInput: document.getElementById('video-title'), imageLinkInput: document.getElementById('image-link'),
                videoLinkInput: document.getElementById('video-link'), addVideoBtn: document.getElementById('add-video-btn'),
                videoListDiv: document.getElementById('video-list'), currentCategorySpan: document.getElementById('current-category-name'),
                editModal: document.getElementById('edit-video-modal'), saveVideoBtn: document.getElementById('save-video-changes-btn'),
                menuToggleBtn: document.getElementById('menu-toggle-btn'), sidebar: document.querySelector('.sidebar'),
                overlay: document.querySelector('.overlay'), sidebarLinks: document.querySelectorAll('.sidebar-menu a'),
                sections: {
                    'analytics-section': document.getElementById('analytics-section'),
                    'settings-section': document.getElementById('settings-section'),
                    'links-section': document.getElementById('links-section'),
                    'video-section': document.getElementById('video-section')
                }
            };

            // Mobile Sidebar Toggle
            allElements.menuToggleBtn.addEventListener('click', () => {
                allElements.sidebar.classList.toggle('open');
                allElements.overlay.classList.toggle('active');
            });
            const closeSidebar = () => {
                allElements.sidebar.classList.remove('open');
                allElements.overlay.classList.remove('active');
            };
            allElements.overlay.addEventListener('click', closeSidebar);
            allElements.sidebarLinks.forEach(link => link.addEventListener('click', (e) => {
                e.preventDefault();
                closeSidebar();
                const targetId = link.getAttribute('href').substring(1);
                showSection(targetId);
                allElements.sidebarLinks.forEach(item => item.classList.remove('active'));
                link.classList.add('active');
            }));

            // Show/Hide sections
            function showSection(sectionId) {
                for (let id in allElements.sections) {
                    allElements.sections[id].style.display = (id === sectionId) ? 'block' : 'none';
                }
            }

            // Auth State
            auth.onAuthStateChanged(user => {
                if (user) {
                    allElements.loginContainer.style.display = 'none';
                    allElements.dashboardWrapper.style.display = 'flex';
                    loadDashboardData();
                    showSection('analytics-section'); // Default section
                } else {
                    allElements.loginContainer.style.display = 'flex';
                    allElements.dashboardWrapper.style.display = 'none';
                    allElements.emailInput.value = '';
                    allElements.passwordInput.value = '';
                    allElements.loginError.textContent = '';
                }
            });

            // Login/Logout
            allElements.loginBtn.addEventListener('click', () => {
                const email = allElements.emailInput.value;
                const password = allElements.passwordInput.value;
                if (!email || !password) {
                    allElements.loginError.textContent = 'ইমেইল এবং পাসওয়ার্ড উভয়ই পূরণ করুন।';
                    return;
                }
                auth.signInWithEmailAndPassword(email, password)
                    .catch(err => { 
                        allElements.loginError.textContent = 'ভুল ইমেইল অথবা পাসওয়ার্ড।'; 
                        console.error(err);
                    });
            });
            allElements.logoutBtn.addEventListener('click', () => auth.signOut());

            function loadDashboardData() {
                db.ref('analytics').on('value', s => {
                    const d = s.val() || {}; 
                    const t = new Date().toISOString().slice(0, 10);
                    allElements.totalUsersSpan.textContent = d.total_users || 0;
                    allElements.totalClicksSpan.textContent = d.total_ad_clicks || 0;
                    allElements.todayClicksSpan.textContent = (d.daily_ad_clicks && d.daily_ad_clicks[t]) ? d.daily_ad_clicks[t] : 0;
                });
                db.ref('settings').on('value', s => {
                    const d = s.val() || {};
                    allElements.liveTextInput.value = d.live_text || ''; 
                    allElements.zoneIdInput.value = d.zone_id || '';
                    allElements.unlockCountInput.value = d.unlock_count || 15; 
                    allElements.rulesTextInput.value = d.rules_text || '';
                });
                db.ref('menu_links').on('value', s => {
                    const d = s.val() || {};
                    allElements.contactLinkInput.value = d.contact_us || ''; 
                    allElements.telegramLinkInput.value = d.telegram || '';
                    allElements.website18LinkInput.value = d.website18 || ''; 
                    allElements.youtubeLinkInput.value = d.youtube || '';
                });
                db.ref('videos').on('value', s => {
                    const cats = s.val() ? Object.keys(s.val()) : []; 
                    const sel = allElements.categorySelect.value;
                    allElements.categorySelect.innerHTML = '';
                    cats.forEach(c => { 
                        const o = document.createElement('option'); 
                        o.value = c; 
                        o.textContent = c; 
                        allElements.categorySelect.appendChild(o); 
                    });
                    if (cats.includes(sel)) allElements.categorySelect.value = sel;
                    if (allElements.categorySelect.value) loadVideosForCategory(allElements.categorySelect.value);
                    else if (cats.length > 0) loadVideosForCategory(cats[0]);
                    else { 
                        allElements.videoListDiv.innerHTML = '<p>কোনো ভিডিও নেই।</p>'; 
                        allElements.currentCategorySpan.textContent = 'N/A'; 
                    }
                });
            }

            // Save Buttons
            allElements.saveSettingsBtn.addEventListener('click', () => {
                const zoneId = allElements.zoneIdInput.value.trim();
                if (!zoneId) {
                    alert('বিজ্ঞাপন জোন আইডি খালি রাখা যাবে না।');
                    return;
                }
                db.ref('settings').set({
                    live_text: allElements.liveTextInput.value.trim(), 
                    zone_id: zoneId,
                    unlock_count: parseInt(allElements.unlockCountInput.value) || 15, 
                    rules_text: allElements.rulesTextInput.value.trim()
                }).then(() => alert('সেটিংস সেভ হয়েছে!'))
                .catch(error => console.error("Error saving settings:", error));
            });
            allElements.saveLinksBtn.addEventListener('click', () => {
                db.ref('menu_links').set({
                    contact_us: allElements.contactLinkInput.value.trim(), 
                    telegram: allElements.telegramLinkInput.value.trim(),
                    website18: allElements.website18LinkInput.value.trim(), 
                    youtube: allElements.youtubeLinkInput.value.trim()
                }).then(() => alert('লিংক সেভ হয়েছে!'))
                .catch(error => console.error("Error saving links:", error));
            });

            // Category Management
            allElements.addCategoryBtn.addEventListener('click', () => {
                const newCat = allElements.newCategoryInput.value.trim();
                if (newCat) {
                    db.ref('videos/' + newCat).once('value', snapshot => {
                        if (snapshot.exists()) {
                            alert('এই ক্যাটাগরি ইতিমধ্যে বিদ্যমান।');
                        } else {
                            db.ref('videos/' + newCat).set({ placeholder: true })
                            .then(() => { 
                                allElements.newCategoryInput.value = ''; 
                                alert('ক্যাটাগরি যোগ হয়েছে!'); 
                            })
                            .catch(error => console.error("Error adding category:", error));
                        }
                    });
                } else {
                    alert('ক্যাটাগরির নাম দিন।');
                }
            });
            allElements.editCategoryBtn.addEventListener('click', () => {
                const oldName = allElements.categorySelect.value; 
                if (!oldName) {
                    alert('কোনো ক্যাটাগরি নির্বাচন করা হয়নি।');
                    return;
                }
                const newName = prompt('নতুন নাম দিন:', oldName); 
                if (!newName || newName.trim() === '' || newName.trim() === oldName) return;
                
                db.ref('videos/' + newName.trim()).once('value', snapshot => {
                    if (snapshot.exists()) {
                        alert('এই নামের ক্যাটাগরি ইতিমধ্যে বিদ্যমান।');
                    } else {
                        db.ref('videos/' + oldName).once('value', s => {
                            const data = s.val(); 
                            const updates = {};
                            updates['/videos/' + oldName] = null; 
                            updates['/videos/' + newName.trim()] = data;
                            db.ref().update(updates)
                            .then(() => alert('নাম পরিবর্তন হয়েছে!'))
                            .catch(error => console.error("Error renaming category:", error));
                        });
                    }
                });
            });
            allElements.deleteCategoryBtn.addEventListener('click', () => {
                const cat = allElements.categorySelect.value; 
                if (!cat) {
                    alert('কোনো ক্যাটাগরি নির্বাচন করা হয়নি।');
                    return;
                }
                if (confirm(`'${cat}' ক্যাটাগরিটি ডিলিট করতে চান?`)) {
                    db.ref('videos/' + cat).remove()
                    .then(() => alert('ক্যাটাগরি ডিলিট হয়েছে!'))
                    .catch(error => console.error("Error deleting category:", error));
                }
            });

            // Video Management
            allElements.categorySelect.addEventListener('change', (e) => loadVideosForCategory(e.target.value));
            function loadVideosForCategory(cat) {
                if (!cat) return;
                allElements.currentCategorySpan.textContent = cat;
                db.ref('videos/' + cat).on('value', s => {
                    const videos = s.val() || {}; 
                    allElements.videoListDiv.innerHTML = '';
                    const videoEntries = Object.entries(videos).filter(([k, v]) => k !== 'placeholder' && typeof v === 'object' && v.title);

                    if (videoEntries.length === 0) { 
                        allElements.videoListDiv.innerHTML = '<p>এই ক্যাটাগরিতে কোনো ভিডিও নেই।</p>'; 
                        return; 
                    }
                    videoEntries.forEach(([key, video]) => {
                        const el = document.createElement('div'); 
                        el.className = 'video-item';
                        el.innerHTML = `<p title="${video.title}">${video.title}</p><div class="video-item-actions"><button class="action-btn edit" data-key="${key}" data-cat="${cat}"><i class="fas fa-edit"></i></button><button class="action-btn delete" data-key="${key}" data-cat="${cat}"><i class="fas fa-trash"></i></button></div>`;
                        allElements.videoListDiv.appendChild(el);
                    });
                });
            }
            allElements.addVideoBtn.addEventListener('click', () => {
                const cat = allElements.categorySelect.value, 
                      t = allElements.videoTitleInput.value.trim(), 
                      i = allElements.imageLinkInput.value.trim(), 
                      l = allElements.videoLinkInput.value.trim();
                if (!cat) {
                    alert('একটি ক্যাটাগরি নির্বাচন করুন।');
                    return;
                }
                if (t && i && l) {
                    const ref = db.ref('videos/' + cat).push();
                    ref.set({ id: ref.key, title: t, img: i, link: l, uploadTime: new Date().toISOString() })
                    .then(() => { 
                        allElements.videoTitleInput.value = ''; 
                        allElements.imageLinkInput.value = ''; 
                        allElements.videoLinkInput.value = ''; 
                        alert('ভিডিও যোগ হয়েছে!'); 
                        db.ref('videos/' + cat + '/placeholder').remove(); 
                    })
                    .catch(error => console.error("Error adding video:", error));
                } else { 
                    alert('সব তথ্য পূরণ করুন।'); 
                }
            });

            // Video List Actions (Edit/Delete)
            allElements.videoListDiv.addEventListener('click', e => {
                const target = e.target.closest('button'); 
                if (!target) return;
                const k = target.dataset.key, c = target.dataset.cat;
                if (target.classList.contains('delete')) { 
                    if (confirm('ভিডিওটি ডিলিট করতে চান?')) {
                        db.ref(`videos/${c}/${k}`).remove()
                        .catch(error => console.error("Error deleting video:", error));
                    }
                } 
                else if (target.classList.contains('edit')) { 
                    openEditModal(k, c); 
                }
            });

            // Modal Functions
            function openEditModal(key, cat) {
                db.ref(`videos/${cat}/${key}`).once('value', s => {
                    const video = s.val();
                    if (video) {
                        document.getElementById('edit-video-key').value = key; 
                        document.getElementById('edit-video-category').value = cat;
                        document.getElementById('edit-video-title').value = video.title; 
                        document.getElementById('edit-image-link').value = video.img;
                        document.getElementById('edit-video-link').value = video.link;
                        allElements.editModal.style.display = 'flex'; // Use flex for centering
                    }
                });
            }
            function closeEditModal(modalId) { 
                document.getElementById(modalId).style.display = 'none'; 
            }
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.onclick = () => closeEditModal(btn.dataset.modal);
            });
            window.onclick = e => { 
                if (e.target == allElements.editModal) closeEditModal('edit-video-modal'); 
            }
            allElements.saveVideoBtn.addEventListener('click', () => {
                const key = document.getElementById('edit-video-key').value, 
                      cat = document.getElementById('edit-video-category').value;
                const data = { 
                    title: document.getElementById('edit-video-title').value.trim(), 
                    img: document.getElementById('edit-image-link').value.trim(), 
                    link: document.getElementById('edit-video-link').value.trim() 
                };
                if (!data.title || !data.img || !data.link) {
                    return alert('সব তথ্য পূরণ করুন।');
                }
                db.ref(`videos/${cat}/${key}`).update(data)
                .then(() => { 
                    alert('ভিডিও আপডেট হয়েছে!'); 
                    closeEditModal('edit-video-modal'); 
                })
                .catch(error => console.error("Error updating video:", error));
            });
        });
    </script>
</body>
</html>
